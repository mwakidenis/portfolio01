name: Daily README Timestamp Update

on:
  workflow_dispatch:       # manual trigger
  schedule:
    - cron: "41 13 * * *"  # daily at 13:41 UTC

permissions:
  contents: write

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout the repository
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # needed for full git history

      # 2️⃣ Update timestamp and commit
      - name: Update timestamp and commit
        run: |
          # Generate current UTC timestamp
          TIMESTAMP=$(date -u +"%Y-%m-%d %H:%M UTC")
          echo "Updating README timestamp to: $TIMESTAMP"

          # Line to insert/update
          TIMESTAMP_LINE="Last updated: $TIMESTAMP"

          # Replace existing timestamp or append if missing
          if grep -q "Last updated:" README.md; then
            sed -i "s/Last updated:.*/$TIMESTAMP_LINE/" README.md
          else
            echo "" >> README.md
            echo "$TIMESTAMP_LINE" >> README.md
          fi

          # Configure Git
          git config user.name "mwakidenis"
          git config user.email "mwakidenice@gmail.com"

          # Stage README
          git add README.md

          # Always commit (even if unchanged) to ensure contribution
          git commit -m "Auto-update README timestamp: $TIMESTAMP" --allow-empty
          git push origin HEAD
